# Firebase App Hosting Configuration
# https://firebase.google.com/docs/app-hosting

# Runtime configuration
runtime: nodejs20

# Build configuration
build:
  # Commands to run during build
  commands:
    - npm ci
    - npm run intlayer:build
    - npm run build
  
  # Environment variables available during build
  env:
    NODE_ENV: production
    NEXT_TELEMETRY_DISABLED: 1

# Runtime environment variables
# These will be available to your app at runtime
env:
  # Application Environment
  - variable: NODE_ENV
    value: production
  - variable: NEXT_TELEMETRY_DISABLED
    value: "1"
  
  # Next.js Configuration
  - variable: NEXT_PUBLIC_APP_URL
    value: https://project-jz-test-backend--project-jz-464301.us-central1.hosted.app/
  
  # Auth.js v5 Configuration (using secrets for sensitive data)
  - variable: AUTH_SECRET
    secret: AUTH_SECRET
  - variable: AUTH_URL
    value: https://project-jz-test-backend--project-jz-464301.us-central1.hosted.app/
  
  # Google OAuth Configuration (using secrets for sensitive data)
  - variable: AUTH_GOOGLE_ID
    secret: AUTH_GOOGLE_ID
  - variable: AUTH_GOOGLE_SECRET
    secret: AUTH_GOOGLE_SECRET
  
  # Firebase Admin Configuration (using secrets for sensitive data)
  - variable: FIREBASE_PROJECT_ID
    value: project-jz-464301
  - variable: FIREBASE_CLIENT_EMAIL
    secret: FIREBASE_CLIENT_EMAIL
  - variable: FIREBASE_PRIVATE_KEY
    secret: FIREBASE_PRIVATE_KEY
  - variable: FIRESTORE_DATABASE_ID
    value: project-jz-firestore-db
  
  # AI Categorization Service
  - variable: AI_CATEGORIZATION_ENDPOINT
    value: https://product-categorizer-364702430350.us-central1.run.app/match

# CPU and memory allocation
cpu: 1
memory: 2Gi

# Minimum and maximum number of instances
minInstances: 0
maxInstances: 10

# Concurrency - number of requests per instance
concurrency: 80

# Health check configuration
healthCheck:
  path: /api/health
  timeout: 30s
  checkInterval: 10s
  failureThreshold: 3
  successThreshold: 1

# Request timeout
timeout: 60s

# Auto-scaling configuration
scaling:
  targetConcurrency: 70
  cooldownPeriod: 5m